<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 9 - WeatherTool MCP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .connection-panel {
            height: fit-content;
        }

        .connection-status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .status-disconnected {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .status-connected {
            background: #d1fae5;
            color: #059669;
            border: 1px solid #a7f3d0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .weather-form {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #374151;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            font-size: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .weather-results {
            margin-top: 30px;
        }

        .weather-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }

        .weather-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .weather-location {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
        }

        .weather-time {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .current-weather {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .weather-metric {
            text-align: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1f2937;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #6b7280;
            margin-top: 5px;
        }

        .temperature {
            font-size: 3rem !important;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .forecast-section {
            margin-top: 20px;
        }

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .forecast-day {
            text-align: center;
            padding: 15px 10px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .forecast-day-name {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .forecast-temps {
            font-size: 0.9rem;
            color: #6b7280;
            margin-top: 5px;
        }

        .alerts-section {
            margin-top: 20px;
        }

        .alert-item {
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 4px solid;
        }

        .alert-high {
            background: #fef2f2;
            border-color: #dc2626;
            color: #7f1d1d;
        }

        .alert-moderate {
            background: #fffbeb;
            border-color: #f59e0b;
            color: #92400e;
        }

        .alert-low {
            background: #f0f9ff;
            border-color: #3b82f6;
            color: #1e40af;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .server-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .info-item {
            margin-bottom: 8px;
        }

        .info-label {
            font-weight: 600;
            color: #374151;
        }

        .info-value {
            color: #6b7280;
        }

        .hidden {
            display: none;
        }

        .text-center {
            text-align: center;
        }

        .error-message {
            padding: 15px;
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #7f1d1d;
            border-radius: 6px;
            margin-top: 15px;
        }

        .success-message {
            padding: 15px;
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            color: #0c4a6e;
            border-radius: 6px;
            margin-top: 15px;
        }

        .quick-locations {
            margin-top: 15px;
        }

        .quick-btn {
            display: inline-block;
            padding: 8px 15px;
            background: #e2e8f0;
            color: #374151;
            border-radius: 20px;
            margin: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            border: 1px solid #d1d5db;
            transition: all 0.3s ease;
        }

        .quick-btn:hover {
            background: #3b82f6;
            color: white;
            transform: translateY(-1px);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .current-weather {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå§Ô∏è WeatherTool MCP</h1>
            <p>Day 9 - Custom Weather Tool through Model Context Protocol</p>
        </div>

        <div class="main-content">
            <!-- Connection Panel -->
            <div class="panel connection-panel">
                <h2>üîó MCP Connection</h2>
                
                <div id="connectionStatus" class="connection-status status-disconnected">
                    ‚ùå Disconnected from Weather MCP Server
                </div>

                <button id="connectBtn" class="btn btn-primary">Connect to Weather MCP</button>
                <button id="disconnectBtn" class="btn btn-danger hidden">Disconnect</button>

                <div id="serverInfo" class="server-info hidden">
                    <h3>üìã Server Information</h3>
                    <div class="info-item">
                        <span class="info-label">Name:</span>
                        <span id="serverName" class="info-value">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Version:</span>
                        <span id="serverVersion" class="info-value">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Custom Tools:</span>
                        <span id="toolCount" class="info-value">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Capabilities:</span>
                        <span id="capabilities" class="info-value">-</span>
                    </div>
                </div>

                <!-- Weather Form -->
                <div id="weatherForm" class="weather-form hidden">
                    <h3>üå§Ô∏è Get Weather Information</h3>
                    
                    <div class="form-group">
                        <label class="form-label" for="location">Location *</label>
                        <input type="text" id="location" class="form-input" 
                               placeholder="Enter city name (e.g., London, New York)" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="weatherType">Information Type</label>
                            <select id="weatherType" class="form-select">
                                <option value="current">Current Weather</option>
                                <option value="forecast">Weather Forecast</option>
                                <option value="detailed">Detailed Information</option>
                                <option value="alerts">Weather Alerts</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="units">Temperature Units</label>
                            <select id="units" class="form-select">
                                <option value="celsius">Celsius (¬∞C)</option>
                                <option value="fahrenheit">Fahrenheit (¬∞F)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group" id="daysGroup">
                        <label class="form-label" for="days">Forecast Days (1-7)</label>
                        <input type="number" id="days" class="form-input" min="1" max="7" value="5">
                    </div>
                    
                    <button id="getWeatherBtn" class="btn btn-success">
                        Get Weather Information
                    </button>

                    <div class="quick-locations">
                        <strong>Quick Locations:</strong><br>
                        <span class="quick-btn" data-location="London">London</span>
                        <span class="quick-btn" data-location="New York">New York</span>
                        <span class="quick-btn" data-location="Tokyo">Tokyo</span>
                        <span class="quick-btn" data-location="Sydney">Sydney</span>
                        <span class="quick-btn" data-location="Paris">Paris</span>
                        <span class="quick-btn" data-location="Berlin">Berlin</span>
                    </div>
                </div>
            </div>

            <!-- Status Panel -->
            <div class="panel">
                <h2>üìä Status & Logs</h2>
                <div id="statusMessages" style="min-height: 300px; max-height: 400px; overflow-y: auto; padding: 15px; background: #f9fafb; border-radius: 6px; font-family: monospace; font-size: 0.9rem;">
                    Ready to connect to WeatherTool MCP server...
                </div>
            </div>
        </div>

        <!-- Weather Results Section -->
        <div id="weatherResults" class="weather-results hidden">
            <div class="panel">
                <h2>üå§Ô∏è Weather Information</h2>
                <div id="weatherContent">
                    <!-- Weather data will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        class WeatherMCPClient {
            constructor() {
                this.isConnected = false;
                this.initializeElements();
                this.setupEventListeners();
                this.checkStatus();
            }

            initializeElements() {
                this.elements = {
                    connectionStatus: document.getElementById('connectionStatus'),
                    connectBtn: document.getElementById('connectBtn'),
                    disconnectBtn: document.getElementById('disconnectBtn'),
                    serverInfo: document.getElementById('serverInfo'),
                    serverName: document.getElementById('serverName'),
                    serverVersion: document.getElementById('serverVersion'),
                    toolCount: document.getElementById('toolCount'),
                    capabilities: document.getElementById('capabilities'),
                    statusMessages: document.getElementById('statusMessages'),
                    weatherForm: document.getElementById('weatherForm'),
                    location: document.getElementById('location'),
                    weatherType: document.getElementById('weatherType'),
                    units: document.getElementById('units'),
                    days: document.getElementById('days'),
                    daysGroup: document.getElementById('daysGroup'),
                    getWeatherBtn: document.getElementById('getWeatherBtn'),
                    weatherResults: document.getElementById('weatherResults'),
                    weatherContent: document.getElementById('weatherContent')
                };
            }

            setupEventListeners() {
                this.elements.connectBtn.addEventListener('click', () => this.connect());
                this.elements.disconnectBtn.addEventListener('click', () => this.disconnect());
                this.elements.getWeatherBtn.addEventListener('click', () => this.getWeather());
                this.elements.weatherType.addEventListener('change', () => this.updateFormVisibility());
                
                // Enter key support for location input
                this.elements.location.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.getWeather();
                    }
                });

                // Quick location buttons
                document.querySelectorAll('.quick-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const location = e.target.dataset.location;
                        this.elements.location.value = location;
                        this.getWeather();
                    });
                });
            }

            updateFormVisibility() {
                const type = this.elements.weatherType.value;
                this.elements.daysGroup.style.display = 
                    (type === 'forecast' || type === 'detailed') ? 'block' : 'none';
            }

            async checkStatus() {
                try {
                    const response = await fetch('/api/mcp/status');
                    const data = await response.json();
                    
                    if (data.connected) {
                        this.updateConnectionState(true, data.serverInfo);
                    } else {
                        this.updateConnectionState(false);
                    }
                } catch (error) {
                    this.addStatusMessage('‚ùå Failed to check connection status', 'error');
                }
            }

            async connect() {
                this.addStatusMessage('üîó Connecting to WeatherTool MCP server...', 'info');
                this.elements.connectBtn.disabled = true;
                this.elements.connectBtn.innerHTML = '<span class="loading"></span> Connecting...';

                try {
                    const response = await fetch('/api/mcp/connect', { method: 'POST' });
                    const data = await response.json();

                    if (data.success) {
                        this.addStatusMessage('‚úÖ ' + data.message, 'success');
                        this.updateConnectionState(true, data.serverInfo);
                    } else {
                        this.addStatusMessage('‚ùå Connection failed: ' + data.error, 'error');
                        this.updateConnectionState(false);
                    }
                } catch (error) {
                    this.addStatusMessage('‚ùå Connection error: ' + error.message, 'error');
                    this.updateConnectionState(false);
                } finally {
                    this.elements.connectBtn.disabled = false;
                    this.elements.connectBtn.innerHTML = 'Connect to Weather MCP';
                }
            }

            async disconnect() {
                this.addStatusMessage('üîå Disconnecting from WeatherTool MCP server...', 'info');
                
                try {
                    const response = await fetch('/api/mcp/disconnect', { method: 'POST' });
                    const data = await response.json();

                    this.addStatusMessage('‚úÖ ' + data.message, 'success');
                    this.updateConnectionState(false);
                    this.clearWeatherResults();
                } catch (error) {
                    this.addStatusMessage('‚ùå Disconnect error: ' + error.message, 'error');
                }
            }

            async getWeather() {
                const location = this.elements.location.value.trim();
                if (!location) {
                    this.addStatusMessage('‚ùå Please enter a location', 'error');
                    return;
                }

                const weatherData = {
                    location: location,
                    type: this.elements.weatherType.value,
                    units: this.elements.units.value,
                    days: parseInt(this.elements.days.value) || 5
                };

                this.addStatusMessage(`üå§Ô∏è Getting weather for ${location}...`, 'info');
                this.elements.getWeatherBtn.disabled = true;
                this.elements.getWeatherBtn.innerHTML = '<span class="loading"></span> Getting Weather...';

                try {
                    const response = await fetch('/api/weather', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(weatherData)
                    });

                    const data = await response.json();

                    if (data.success) {
                        this.addStatusMessage(`‚úÖ Weather data retrieved for ${location} (${data.executionTime}ms)`, 'success');
                        this.displayWeatherResults(data.weather);
                    } else {
                        this.addStatusMessage('‚ùå Weather request failed: ' + data.error, 'error');
                    }
                } catch (error) {
                    this.addStatusMessage('‚ùå Network error: ' + error.message, 'error');
                } finally {
                    this.elements.getWeatherBtn.disabled = false;
                    this.elements.getWeatherBtn.innerHTML = 'Get Weather Information';
                }
            }

            updateConnectionState(connected, serverInfo = null) {
                this.isConnected = connected;
                
                if (connected) {
                    this.elements.connectionStatus.className = 'connection-status status-connected';
                    this.elements.connectionStatus.textContent = '‚úÖ Connected to WeatherTool MCP Server';
                    this.elements.connectBtn.classList.add('hidden');
                    this.elements.disconnectBtn.classList.remove('hidden');
                    this.elements.weatherForm.classList.remove('hidden');
                    
                    if (serverInfo) {
                        this.elements.serverInfo.classList.remove('hidden');
                        this.elements.serverName.textContent = serverInfo.name || 'Unknown';
                        this.elements.serverVersion.textContent = serverInfo.version || 'Unknown';
                        this.elements.toolCount.textContent = serverInfo.toolsCount || '0';
                        this.elements.capabilities.textContent = 
                            JSON.stringify(serverInfo.capabilities || {});
                    }
                } else {
                    this.elements.connectionStatus.className = 'connection-status status-disconnected';
                    this.elements.connectionStatus.textContent = '‚ùå Disconnected from WeatherTool MCP Server';
                    this.elements.connectBtn.classList.remove('hidden');
                    this.elements.disconnectBtn.classList.add('hidden');
                    this.elements.weatherForm.classList.add('hidden');
                    this.elements.serverInfo.classList.add('hidden');
                    this.elements.toolCount.textContent = '0';
                }

                this.updateFormVisibility();
            }

            displayWeatherResults(weather) {
                if (weather.error) {
                    this.elements.weatherContent.innerHTML = `
                        <div class="error-message">
                            ‚ùå Error: ${weather.message}
                        </div>
                    `;
                } else {
                    this.elements.weatherContent.innerHTML = this.formatWeatherData(weather);
                }
                
                this.elements.weatherResults.classList.remove('hidden');
                this.elements.weatherResults.scrollIntoView({ behavior: 'smooth' });
            }

            formatWeatherData(weather) {
                let html = `
                    <div class="weather-card">
                        <div class="weather-header">
                            <div class="weather-location">${weather.location}</div>
                            <div class="weather-time">${new Date(weather.timestamp).toLocaleString()}</div>
                        </div>
                `;

                if (weather.current) {
                    html += `
                        <div class="current-weather">
                            <div class="weather-metric">
                                <div class="metric-value temperature">${weather.current.temperature}¬∞</div>
                                <div class="metric-label">Temperature</div>
                            </div>
                            <div class="weather-metric">
                                <div class="metric-value">${weather.current.condition}</div>
                                <div class="metric-label">Condition</div>
                            </div>
                    `;

                    if (weather.current.humidity !== undefined) {
                        html += `
                            <div class="weather-metric">
                                <div class="metric-value">${weather.current.humidity}%</div>
                                <div class="metric-label">Humidity</div>
                            </div>
                        `;
                    }

                    if (weather.current.windSpeed !== undefined) {
                        html += `
                            <div class="weather-metric">
                                <div class="metric-value">${weather.current.windSpeed}</div>
                                <div class="metric-label">Wind (km/h)</div>
                            </div>
                        `;
                    }

                    if (weather.current.pressure !== undefined) {
                        html += `
                            <div class="weather-metric">
                                <div class="metric-value">${weather.current.pressure}</div>
                                <div class="metric-label">Pressure (hPa)</div>
                            </div>
                        `;
                    }

                    html += '</div>';
                }

                if (weather.forecast && weather.forecast.length > 0) {
                    html += `
                        <div class="forecast-section">
                            <h3>üìÖ Weather Forecast</h3>
                            <div class="forecast-grid">
                    `;
                    
                    weather.forecast.forEach(day => {
                        html += `
                            <div class="forecast-day">
                                <div class="forecast-day-name">${day.day}</div>
                                <div class="metric-value">${day.condition}</div>
                                <div class="forecast-temps">${day.high}¬∞ / ${day.low}¬∞</div>
                            </div>
                        `;
                    });
                    
                    html += '</div></div>';
                }

                if (weather.alerts && weather.alerts.length > 0) {
                    html += `
                        <div class="alerts-section">
                            <h3>‚ö†Ô∏è Weather Alerts</h3>
                    `;
                    
                    weather.alerts.forEach(alert => {
                        const alertClass = alert.severity === 'High' ? 'alert-high' : 
                                          alert.severity === 'Moderate' ? 'alert-moderate' : 'alert-low';
                        html += `
                            <div class="alert-item ${alertClass}">
                                <strong>${alert.type}</strong> (${alert.severity})<br>
                                ${alert.message}
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                }

                if (weather.details) {
                    html += `
                        <div class="forecast-section">
                            <h3>üîç Additional Details</h3>
                            <div class="current-weather">
                                <div class="weather-metric">
                                    <div class="metric-value">${weather.details.sunrise}</div>
                                    <div class="metric-label">Sunrise</div>
                                </div>
                                <div class="weather-metric">
                                    <div class="metric-value">${weather.details.sunset}</div>
                                    <div class="metric-label">Sunset</div>
                                </div>
                                <div class="weather-metric">
                                    <div class="metric-value">${weather.details.moonPhase}</div>
                                    <div class="metric-label">Moon Phase</div>
                                </div>
                    `;

                    if (weather.details.airQuality) {
                        html += `
                                <div class="weather-metric">
                                    <div class="metric-value">${weather.details.airQuality.quality}</div>
                                    <div class="metric-label">Air Quality (${weather.details.airQuality.index})</div>
                                </div>
                        `;
                    }

                    html += '</div></div>';
                }

                html += `
                        <div class="success-message">
                            üí¨ ${weather.summary}
                        </div>
                    </div>
                `;

                return html;
            }

            clearWeatherResults() {
                this.elements.weatherResults.classList.add('hidden');
                this.elements.weatherContent.innerHTML = '';
            }

            addStatusMessage(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const emoji = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
                
                this.elements.statusMessages.innerHTML += 
                    `[${timestamp}] ${emoji} ${message}\n`;
                this.elements.statusMessages.scrollTop = this.elements.statusMessages.scrollHeight;
            }
        }

        // Initialize the WeatherTool MCP Client
        const weatherClient = new WeatherMCPClient();
    </script>
</body>
</html>